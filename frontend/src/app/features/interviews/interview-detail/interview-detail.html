@if (loading() && !interview()) {
  <div class="spinner-container">
    <mat-spinner diameter="48" />
  </div>
} @else if (interview(); as iv) {
  <mat-card class="detail-card">
    <div class="card-header-band">
      <div class="header-main">
        <h2 class="card-title">{{ iv.techStack }}</h2>
        <mat-chip-set>
          <mat-chip [class]="'status-' + iv.status.toLowerCase()">{{ iv.status }}</mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <mat-card-content class="detail-content">
      <div class="detail-grid">
        <div class="detail-item">
          <span class="label">Interviewer</span>
          <span>{{ iv.interviewer.email }}</span>
        </div>
        @if (iv.candidateInfo['name']) {
          <div class="detail-item">
            <span class="label">Candidate</span>
            <span>{{ iv.candidateInfo['name'] }}</span>
          </div>
        }
        @if (iv.candidateInfo['email']) {
          <div class="detail-item">
            <span class="label">Candidate Email</span>
            <span>{{ iv.candidateInfo['email'] }}</span>
          </div>
        }
        <div class="detail-item">
          <span class="label">Start</span>
          <span>{{ iv.startTime | date:'medium' }}</span>
        </div>
        <div class="detail-item">
          <span class="label">End</span>
          <span>{{ iv.endTime | date:'medium' }}</span>
        </div>
      </div>
    </mat-card-content>

    <mat-card-actions class="card-actions">
      @if (iv.status === 'SCHEDULED') {
        @if (isOwner()) {
          <button mat-stroked-button class="edit-btn" (click)="openEditDialog()">
            <mat-icon>edit</mat-icon> Edit
          </button>
          <button mat-stroked-button color="warn" (click)="cancelInterview()">
            <mat-icon>cancel</mat-icon> Cancel Interview
          </button>
        }
        @if (!isOwner()) {
          <button mat-flat-button class="shadow-btn" (click)="requestShadow()">
            <mat-icon>visibility</mat-icon> Request to Shadow
          </button>
        }
      }
    </mat-card-actions>
  </mat-card>

  @if (iv.shadowingRequests && iv.shadowingRequests.length > 0) {
    <mat-card class="shadowing-card">
      <mat-card-header>
        <mat-icon matCardAvatar class="section-icon">group</mat-icon>
        <mat-card-title>Shadowing Requests</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-list>
          @for (sr of iv.shadowingRequests; track sr.id) {
            <mat-list-item class="shadowing-item">
              <span matListItemTitle>{{ sr.shadower.email }}</span>
              <span matListItemLine>
                <mat-chip-set>
                  <mat-chip [class]="'status-' + sr.status.toLowerCase()">{{ sr.status }}</mat-chip>
                </mat-chip-set>
                @if (sr.reason) {
                  <span class="reason">Reason: {{ sr.reason }}</span>
                }
              </span>
              <span matListItemMeta>
                @if (sr.status === 'PENDING' && isOwner()) {
                  <button mat-icon-button class="approve-btn" (click)="approveShadowing(sr.id)" title="Approve">
                    <mat-icon>check_circle</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" (click)="rejectShadowing(sr.id)" title="Reject">
                    <mat-icon>cancel</mat-icon>
                  </button>
                }
                @if (sr.status === 'PENDING' && sr.shadower.id === profileId()) {
                  <button mat-icon-button (click)="cancelShadowing(sr.id)" title="Cancel Request">
                    <mat-icon>delete</mat-icon>
                  </button>
                }
              </span>
            </mat-list-item>
            <mat-divider />
          }
        </mat-list>
      </mat-card-content>
    </mat-card>
  }
}
